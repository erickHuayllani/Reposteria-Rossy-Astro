---
import BaseLayout from "../layouts/BaseLayout.astro";
---
<BaseLayout title="Carrito - Reposter√≠a D'Rossy">
  <link rel="stylesheet" href="/src/styles/carrito.css" />

  <section class="px-4 md:px-10 py-10 bg-gradient-to-br from-pink-50 to-rose-100 min-h-screen">
    <h1 class="text-4xl font-bold text-center mb-10 text-rose-700">
      üßÅ Tu carrito D‚ÄôRossy
    </h1>

    <div class="grid md:grid-cols-3 gap-10">
      <!-- üß∏ Productos -->
      <div class="md:col-span-2">
        <div class="bg-white p-6 rounded-2xl shadow-lg">
          <h2 class="text-2xl font-semibold mb-6 text-rose-600">
            Elige tus productos favoritos üç∞
          </h2>

          <div id="product-list" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- EJEMPLOS -->
            <article class="product-card" data-id="1" data-name="Pastel Bob Esponja" data-price="60" data-img="/img/bob esponja.png">
              <img src="/img/bob esponja.png" alt="Pastel Bob Esponja" />
              <h3>Pastel Bob Esponja</h3>
              <p>Decorado con fondant.</p>
              <div class="bottom">
                <span class="price">$60.00</span>
                <button class="add-btn">Agregar</button>
              </div>
            </article>

            <article class="product-card" data-id="2" data-name="Torta Corona" data-price="55" data-img="/img/corona.png">
              <img src="/img/corona.png" alt="Torta Corona" />
              <h3>Torta Corona</h3>
              <p>Decorada con frutas y crema.</p>
              <div class="bottom">
                <span class="price">$55.00</span>
                <button class="add-btn">Agregar</button>
              </div>
            </article>

            <article class="product-card" data-id="3" data-name="Pastel de Chocolate" data-price="52" data-img="/img/pastelchoco.png">
              <img src="/img/pastelPollo.png" alt="Pastel de Chocolate" />
              <h3>Pastel de Chocolate</h3>
              <p>Relleno con ganache suave.</p>
              <div class="bottom">
                <span class="price">$52.00</span>
                <button class="add-btn">Agregar</button>
              </div>
            </article>

            <article class="product-card" data-id="4" data-name="Pastel de Frutas" data-price="48" data-img="/img/pastelfrutas.png">
              <img src="/img/Pokemom.png" alt="Pastel de Frutas" />
              <h3>Pastel de Frutas</h3>
              <p>Ligero y con frutas frescas.</p>
              <div class="bottom">
                <span class="price">$48.00</span>
                <button class="add-btn">Agregar</button>
              </div>
            </article>

            <article class="product-card" data-id="5" data-name="Delivery R√°pido" data-price="10" data-img="/img/deliveryyy.png">
              <img src="/img/tortahelada.jpg" alt="Delivery R√°pido" />
              <h3>Torta Helada</h3>
              <p>"Ll√©valo hasta tu puerta"</p>
              <div class="bottom">
                <span class="price">$10.00</span>
                <button class="add-btn">Agregar</button>
              </div>
            </article>
          </div>
        </div>
      </div>

      <!-- üõí Carrito -->
      <div class="bg-white p-6 rounded-2xl shadow-lg h-fit sticky top-6">
        <h2 class="text-xl font-semibold mb-3 text-rose-700">Tu pedido üõçÔ∏è</h2>
        <ul id="cart-list" class="space-y-3"></ul>
        <div class="border-t mt-4 pt-3 flex justify-between items-center">
          <strong>Total:</strong> <span id="total" class="text-lg font-bold">$0.00</span>
        </div>

        <div class="flex flex-col gap-3 mt-4">
          <button id="clear-cart" class="w-full bg-gray-200 text-gray-700 py-2 rounded-lg hover:bg-gray-300 transition-colors">
            Vaciar carrito
          </button>

          <!-- üßæ Ir a pagar -->
          <button id="checkout-btn" class="w-full bg-gradient-to-r from-rose-500 to-pink-500 text-white py-3 rounded-xl text-lg font-semibold shadow hover:opacity-90 transition-all">
            üí≥ Ir a pagar
          </button>
        </div>
      </div>
    </div>
  </section>

  <!-- üîß Script del carrito -->
  <script is:inline>
    const cartList = document.getElementById('cart-list');
    const totalSpan = document.getElementById('total');
    const clearBtn = document.getElementById('clear-cart');
    const checkoutBtn = document.getElementById('checkout-btn');
    let cart = JSON.parse(localStorage.getItem('cart') || '[]');

    function saveCart() {
      localStorage.setItem('cart', JSON.stringify(cart));
      renderCart();
    }

    function renderCart() {
      cartList.innerHTML = '';
      let total = 0;
      cart.forEach(item => {
        const li = document.createElement('li');
        li.className = 'flex items-center justify-between bg-rose-50 p-3 rounded-lg shadow-sm';
        li.innerHTML = `
          <div class="flex items-center gap-3">
            <img src="${item.img}" alt="${item.name}" class="w-12 h-12 rounded-md object-cover"/>
            <div>
              <strong>${item.name}</strong><br>
              <small>$${item.price} x ${item.qty}</small>
            </div>
          </div>
          <div class="flex gap-2">
            <button class="text-sm bg-gray-200 px-2 rounded" data-action="decrease">-</button>
            <button class="text-sm bg-gray-200 px-2 rounded" data-action="increase">+</button>
            <button class="text-sm bg-red-400 text-white px-2 rounded" data-action="remove">üóë</button>
          </div>
        `;
        li.querySelectorAll('button').forEach(btn => {
          btn.addEventListener('click', () => handleAction(item.id, btn.dataset.action));
        });
        cartList.appendChild(li);
        total += item.price * item.qty;
      });
      totalSpan.textContent = `$${total.toFixed(2)}`;
    }

    function handleAction(id, action) {
      const item = cart.find(p => p.id === id);
      if (!item) return;
      if (action === 'increase') item.qty++;
      if (action === 'decrease') item.qty = Math.max(1, item.qty - 1);
      if (action === 'remove') cart = cart.filter(p => p.id !== id);
      saveCart();
    }

    document.querySelectorAll('.add-btn').forEach(btn => {
      btn.addEventListener('click', e => {
        const card = e.target.closest('.product-card');
        const id = card.dataset.id;
        const existing = cart.find(p => p.id === id);
        if (existing) {
          existing.qty++;
        } else {
          cart.push({
            id,
            name: card.dataset.name,
            price: parseFloat(card.dataset.price),
            img: card.dataset.img,
            qty: 1
          });
        }
        saveCart();
      });
    });

    clearBtn.addEventListener('click', () => {
      cart = [];
      saveCart();
    });

    // üëâ Funci√≥n del bot√≥n "Ir a pagar"
    checkoutBtn.addEventListener('click', () => {
      if (cart.length === 0) {
        alert("üß∫ Tu carrito est√° vac√≠o.");
        return;
      }
      const total = totalSpan.textContent;
      alert(`üéâ Gracias por tu compra!\nTotal a pagar: ${total}\n\n(Pr√≥ximamente redirigiremos al pago üí≥)`);
      // Aqu√≠ podr√≠as redirigir, ejemplo:
      // window.location.href = "/pago";
    });

    renderCart();
  </script>

  <style>
    .product-card {
      @apply flex flex-col bg-rose-50 rounded-2xl p-4 shadow transition-transform hover:scale-105 hover:shadow-lg;
    }
    .product-card img {
      @apply rounded-xl w-full h-40 object-cover mb-2;
    }
    .bottom {
      @apply flex justify-between items-center mt-2;
    }
    .add-btn {
      @apply bg-rose-500 text-white px-3 py-1 rounded-lg hover:bg-rose-600 transition;
    }
  </style>
</BaseLayout>
